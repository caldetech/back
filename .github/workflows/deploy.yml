name: ğŸš€ Deploy direto para Elastic Beanstalk (sem Docker)

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout do cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸ“¦ Instalar dependÃªncias
        run: npm install

      - name: âš™ï¸ Gerar arquivos do Prisma
        run: npx prisma generate

      - name: ğŸ› ï¸ Build do projeto
        run: npm run build

      - name: ğŸ”’ Remover arquivos desnecessÃ¡rios
        run: rm -rf node_modules/.prisma node_modules/@prisma/client/libquery_engine* # sÃ³ se quiser reduzir o tamanho

      - name: ğŸ—œï¸ Empacotar arquivos para deploy
        run: zip -r deploy.zip dist node_modules package*.json prisma .platform

      - name: ğŸš€ Deploy para Elastic Beanstalk
        uses: einaregilsson/beanstalk-deploy@v22
        with:
          application_name: management-system_back
          environment_name: back
          version_label: ${{ github.sha }}-${{ github.run_attempt }}
          region: us-east-1
          deployment_package: deploy.zip
          aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          wait_for_deployment: true
